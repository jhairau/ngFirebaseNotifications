/**
 * Angular + Firebase Notifications Service for publishing & subscribing to topics
 * @version v0.0.1 - 2015-08-02
 * @link https://github.com/jhairau/ngFirebaseNotifications
 * @author Johnathan Hair <johnathan.hair.au@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){b.module("ngFirebaseNotifications",["firebase"]).provider("ngFirebaseNotificationsConfig",function(){var a={firebaseUrl:null,firbaseQueueBase:"/"};return this.setConfig=function(c){b.extend(a,c)},this.getConfig=function(){return a},this.getConfigValue=function(b){return a[b]},this.$get=function(){return{get:this.getConfigValue}},this}),b.module("ngFirebaseNotifications").service("ngFirebaseNotifications",["ngFirebaseNotificationsConfig","$firebaseArray",function(a,c){var d=a.get("firebaseUrl"),e=a.get("firbaseQueueBase"),f=new Firebase(d).child(e),g=[],h={},i=c.$extend({publish:function(a,b){this.$add({subject:a,message:btoa(JSON.stringify(b)),createdAt:Firebase.ServerValue.TIMESTAMP})},$$added:function(a){return a.$id=a.key(),a.$priority=a.getPriority(),a},$$updated:function(a){var c=a.val();if(b.equals(c,h))return h=c,a;h=c;var d=a.ref(),e="";if(b.forEach(d.path.pieces_,function(a){e+=a+"/"}),e=e.replace("/"+a.key()+"/",""),g[e]){var f=a.key(),i=c.subject,j=JSON.parse(atob(c.message));b.forEach(g[e].subscribers,function(a){a.call(null,f,i,j)})}return a}}),j=function(){};return j.prototype.init=function(a){return b.isObject(g[a])||(g[a]={channel:new i(f.child(a)),subscribers:[]}),!0},j.prototype.subscribe=function(a,b){this.init(a),g[a].subscribers.push(b)},j.prototype.publish=function(a,b,c){this.init(a),g[a].channel.publish(b,c)},{subscribe:function(a,b){var c=new j;return c.subscribe(a,b),!0},unsubscribe:function(a){var b=Object.keys(subscriptions),c=b.indexOf(a);return-1!==c?(subscriptions.splice(c,1),!0):!1},publish:function(a,b,c){var d=new j;d.publish(a,b,c)}}}])}(window,window.angular);